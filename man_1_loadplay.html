<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>powerd++: loadplay(1)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">powerd++
   &#160;<span id="projectnumber">0.3.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">loadplay(1) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Manual page for <code>loadplay(1)</code>.</p>
<hr/>
<pre>
loadplay(1)             FreeBSD General Commands Manual            loadplay(1)</pre><pre><b>NAME</b>
     <b>loadplay </b>&mdash; CPU load player</pre><pre><b>SYNOPSIS</b>
     <b>loadplay -h</b>
     <b>loadplay </b>[<b>-i </b><em>file</em>] [<b>-o </b><em>file</em>] <em>command</em> <em>...</em></pre><pre><b>DESCRIPTION</b>
     The <b>loadplay </b>command replays a load recording created with loadrec(1).
     The <em>command</em> can either be powerd(8) or powerd++(8), compatibility with
     other tools has not been tested.</pre><pre>   <b>OPTIONS</b>
     The following options are supported:</pre><pre>     <b>-h</b>, <b>&ndash;help</b>
             Show usage and exit.</pre><pre>     <b>-i</b>, <b>&ndash;input </b><em>file</em>
             Read load recording from <em>file</em> instead of <em>stdin</em>.</pre><pre>     <b>-o</b>, <b>&ndash;output </b><em>file</em>
             Output statistics to <em>file</em> instead of <em>stdout</em>.</pre><pre><b>USAGE NOTES</b>
     The <b>loadplay </b>command is a shell script that injects <em>libloadplay.so</em> into
     <em>command</em>.  This library simulates the load from the input and outputs load
     statistics.  If <em>command</em> generates output on <em>stdout</em>, it will be mixed into
     the load statistics. So powerd(8) should be run without the <b>-v </b>flag and
     powerd++(8) without the <b>-f </b>flag.</pre><pre>   <b>OUTPUT</b>
     The first line of output contains column headings, columns are separated
     by a single space.</pre><pre>     The Following columns are present, columns containing <b>d </b>occur for each
     core simulated:</pre><pre>     <b>time[s]</b>
             The simulation progress in seconds.</pre><pre>     <b>cpu.d.freq[MHz]</b>
             The current clock speed rating.</pre><pre>     <b>cpu.d.recload</b>
             The load as recorded, a value in the range [0, 1.0].</pre><pre>     <b>cpu.d.load</b>
             The load under the current clock speed. This value may go above
             1.0, because the current speed rating may be too low to consume
             the load.  In this case the unconsumed load (i.e. everything
             above 1.0) spills over to the next simulation frame.</pre><pre>     <b>max(freqs)[MHz]</b>
             The highest clock speed in the output line.</pre><pre>     <b>sum(recloads)</b>
             The sum of recorded loads in in the output line, a value in the
             range [0, ncpu].</pre><pre>     <b>max(recloads)</b>
             The highest recorded load in this output line, a value in the
             range [0, 1.0].</pre><pre>     <b>sum(loads)</b>
             The sum of loads according to the current clock speed in the out-
             put line.</pre><pre>     <b>max(loads)</b>
             The highest load according to the current clock speed in the out-
             put line.</pre><pre>   <b>SAMPLING</b>
     There is one sample for each recorded line. The duration of each frame
     depends on the recording, which defaults to 25 ms.  At this sample rate
     loads are dominated by noise, so a gliding average should be applied to
     any load columns for further use, such as plotting.  Note that the <b>max()</b>
     columns must be recreated in this case.</pre><pre><b>IMPLEMENTATION</b>
     The injected <em>libloadplay.so</em> works by intercepting system function calls
     and substituting the host environment with the recording. To achieve this
     the following function calls are intercepted:</pre><pre>     <b>路   </b>sysctl(3), sysctlnametomib(3), sysctlbyname(3)</pre><pre>     <b>路   </b>daemon(3)</pre><pre>     <b>路   </b>geteuid(2)</pre><pre>     <b>路   </b>pidfile_open(3), pidfile_write, pidfile_close(3), pidfile_remove(3),
         pidfile_fileno(3)</pre><pre>   <b>INITIALISATION</b>
     The <b>sysctl </b>family of functions is backed by a table that is initialised
     from the header of the load recording. If the heading is incomplete the
     setup routines print a message on <em>stderr</em>.  All the following intercepted
     function calls will return failure, ensuring that the hijacked process is
     unable to operate and terminates.</pre><pre>     Like powerd++(8) and loadrec(1) <b>loadplay </b>is core agnostic. Meaning that
     any core may have a <b>.freq </b>and <b>.freq_levels </b>sysctl handle. Due to this
     flexibility load recordings may in part or wholly be fabricated to test
     artificial loads or systems and features that do not yet exist. E.g. it
     is possible to offer a <b>.freq </b>handle for each core or fabricate new
     <b>.freq_levels</b>.</pre><pre>   <b>SIMULATION</b>
     If setup succeeds a simulation thread is started that reads the remaining
     input lines, simulates the load and updates the <b>kern.cp_times </b>entry in
     the thread safe sysctl table. For each frame a line of output with load
     statistics is produced.</pre><pre>     Interaction with the hijacked process happens solely through the sysctl
     table. The simulation reads the recorded loads and the current core fre-
     quencies to update <b>kern.cp_times</b>.  The hijacked process reads this data
     and adjusts the clock frequencies, which in turn affects the next frame.</pre><pre>   <b>FINALISATION</b>
     After reading the last line of input the simulation thread sends a <b>SIGINT</b>
     to the process to cause it to terminate.</pre><pre><b>FILES</b>
     <em>%PREFIX%%/lib/libloadplay.so</em> A library injected into <em>command</em> via the
     LD_PRELOAD environment variable.</pre><pre><b>SEE ALSO</b>
     loadrec(1), powerd(8), powerd++(8), rtld(1), signal(3)</pre><pre><b>AUTHORS</b>
     Implementation and manual by Dominic Fandrey <a href="#" onclick="location.href='mai'+'lto:'+'kam'+'i@'+'fre'+'eb'+'sd.'+'or'+'g'; return false;">kami@<span style="display: none;">.nosp@m.</span>free<span style="display: none;">.nosp@m.</span>bsd.o<span style="display: none;">.nosp@m.</span>rg</a></pre><pre>FreeBSD 11.1                   19 October, 2016                   FreeBSD 11.1
</pre> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
